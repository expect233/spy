# èª°æ˜¯è‡¥åº• - ç·šä¸Šå¤šäººéŠæˆ²

ä¸€å€‹åŠŸèƒ½å®Œæ•´çš„ç·šä¸Šã€Œèª°æ˜¯è‡¥åº•ã€éŠæˆ²ï¼Œæ”¯æ´å¤šäººå¯¦æ™‚å°æˆ°ã€èªéŸ³èŠå¤©ã€é ­åƒè‡ªå®šç¾©ç­‰è±å¯ŒåŠŸèƒ½ã€‚

## ğŸ® åŠŸèƒ½ç‰¹è‰²

### æ ¸å¿ƒéŠæˆ²åŠŸèƒ½
- ğŸ¯ **å¤šäººå¯¦æ™‚éŠæˆ²** - æ”¯æ´ 3-8 äººåŒæ™‚éŠæˆ²
- ğŸ  **æˆ¿é–“ç³»çµ±** - å‰µå»º/åŠ å…¥æˆ¿é–“ï¼Œæˆ¿é–“ä»£ç¢¼åˆ†äº«
- ğŸ‘¥ **è§’è‰²åˆ†é…** - è‡ªå‹•åˆ†é…å¹³æ°‘ã€è‡¥åº•ã€ç™½æ¿è§’è‰²
- ğŸ’¬ **ç™¼è¨€ç³»çµ±** - æ¯è¼ªé™æ™‚ç™¼è¨€ï¼Œå…§å®¹éæ¿¾
- ğŸ—³ï¸ **æŠ•ç¥¨æ·˜æ±°** - å¯¦æ™‚æŠ•ç¥¨ï¼ŒåŒç¥¨æˆ¿ä¸»è£æ±º
- ğŸ† **å‹è² åˆ¤å®š** - æ™ºèƒ½åˆ¤æ–·éŠæˆ²çµæœ

### ç¤¾äº¤åŠŸèƒ½
- ğŸ’¬ **å³æ™‚èŠå¤©** - æˆ¿é–“èŠå¤©å®¤ï¼Œç‹€æ…‹æ§åˆ¶
- ğŸ¨ **é ­åƒç³»çµ±** - é è¨­æ¨£å¼ + è‡ªå®šç¾©ä¸Šå‚³
- ğŸ‘¤ **å€‹äººè³‡æ–™** - æŒä¹…åŒ–ç©å®¶èº«ä»½
- ğŸ”— **å¥½å‹ç³»çµ±** - ç©å®¶é€£æ¥ç‹€æ…‹é¡¯ç¤º

### æˆ¿ä¸»æ§åˆ¶
- âš™ï¸ **éŠæˆ²è¨­å®š** - è‡¥åº•æ•¸é‡ã€ç™½æ¿æ•¸é‡ã€è¨ˆæ™‚å™¨
- ğŸ‘‘ **æˆ¿ä¸»æ¬Šé™** - é–‹å§‹/çµæŸéŠæˆ²ã€è¸¢äººã€è½‰ç§»æˆ¿ä¸»
- âš–ï¸ **åŒç¥¨è£æ±º** - æŠ•ç¥¨å¹³å±€æ™‚æˆ¿ä¸»æœ€çµ‚æ±ºå®š
- ğŸ“Š **éŠæˆ²çµ±è¨ˆ** - å¯¦æ™‚é¡¯ç¤ºéŠæˆ²é€²åº¦

### æŠ€è¡“ç‰¹è‰²
- ğŸ“± **éŸ¿æ‡‰å¼è¨­è¨ˆ** - å®Œç¾é©é…æ‰‹æ©Ÿã€å¹³æ¿ã€é›»è…¦
- âš¡ **å¯¦æ™‚åŒæ­¥** - Firebase å¯¦æ™‚è³‡æ–™åº«
- ğŸ”’ **å®‰å…¨é˜²è­·** - å…§å®¹éæ¿¾ã€é€Ÿç‡é™åˆ¶ã€æ¬Šé™æ§åˆ¶
- ğŸ¨ **ç¾ä»£ UI** - shadcn/ui çµ„ä»¶åº«ï¼Œç²¾ç¾ç•Œé¢

## ğŸ›  æŠ€è¡“æ£§

- **å‰ç«¯æ¡†æ¶**: Next.js 15 + TypeScript
- **UI çµ„ä»¶**: shadcn/ui + Tailwind CSS
- **ç‹€æ…‹ç®¡ç†**: Zustand
- **å¾Œç«¯æœå‹™**: Firebase Functions
- **è³‡æ–™åº«**: Firestore
- **æª”æ¡ˆå­˜å„²**: Firebase Storage
- **å¯¦æ™‚é€šä¿¡**: Firestore å¯¦æ™‚ç›£è½
- **éƒ¨ç½²å¹³å°**: Firebase Hosting
- **æ¸¬è©¦æ¡†æ¶**: Vitest + Playwright

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒè¦æ±‚

- Node.js >= 20
- npm æˆ– yarn
- Firebase CLI

### æœ¬åœ°é–‹ç™¼

1. **å…‹éš†å°ˆæ¡ˆ**
```bash
git clone <repository-url>
cd undercover-game
```

2. **å®‰è£ä¾è³´**
```bash
npm install
cd functions && npm install && cd ..
```

3. **Firebase è¨­ç½®**
```bash
# ç™»å…¥ Firebase
firebase login

# é¸æ“‡ Firebase å°ˆæ¡ˆ
firebase use --add

# åˆå§‹åŒ– Firebase é…ç½®
firebase init
```

4. **ç’°å¢ƒé…ç½®**
```bash
# è¤‡è£½ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
cp .env.example .env.local

# ç·¨è¼¯ç’°å¢ƒè®Šæ•¸
# NEXT_PUBLIC_FIREBASE_API_KEY=your_api_key
# NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your_auth_domain
# ...
```

5. **å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ**
```bash
# å•Ÿå‹• Firebase æ¨¡æ“¬å™¨
npm run emulators

# æ–°çµ‚ç«¯å•Ÿå‹• Next.js é–‹ç™¼æœå‹™å™¨
npm run dev
```

6. **è¨ªå•æ‡‰ç”¨**
- å‰ç«¯: http://localhost:3000
- Firebase æ¨¡æ“¬å™¨ UI: http://localhost:4000

### ç”Ÿç”¢éƒ¨ç½²

```bash
# å»ºæ§‹å°ˆæ¡ˆ
npm run build

# éƒ¨ç½²åˆ° Firebase
firebase deploy

# æˆ–åˆ†åˆ¥éƒ¨ç½²
firebase deploy --only hosting
firebase deploy --only functions
firebase deploy --only firestore:rules
firebase deploy --only storage:rules
```

## ğŸ¯ éŠæˆ²è¦å‰‡

### åŸºæœ¬æµç¨‹
1. **æˆ¿é–“å‰µå»º** - æˆ¿ä¸»å‰µå»ºéŠæˆ²æˆ¿é–“ï¼Œç²å¾— 6 ä½æ•¸æˆ¿é–“ä»£ç¢¼
2. **ç©å®¶åŠ å…¥** - å…¶ä»–ç©å®¶è¼¸å…¥æˆ¿é–“ä»£ç¢¼åŠ å…¥éŠæˆ²
3. **éŠæˆ²è¨­å®š** - æˆ¿ä¸»èª¿æ•´è‡¥åº•æ•¸é‡ã€ç™½æ¿æ•¸é‡ã€è¨ˆæ™‚å™¨ç­‰
4. **é–‹å§‹éŠæˆ²** - ç³»çµ±éš¨æ©Ÿåˆ†é…è§’è‰²å’Œè©èª
5. **ç™¼è¨€éšæ®µ** - æ¯ä½ç©å®¶ä¾æ¬¡æè¿°è‡ªå·±çš„è©èªï¼ˆé™æ™‚ 60 ç§’ï¼‰
6. **æŠ•ç¥¨éšæ®µ** - æ‰€æœ‰ç©å®¶æŠ•ç¥¨é¸å‡ºç–‘ä¼¼è‡¥åº•ï¼ˆé™æ™‚ 30 ç§’ï¼‰
7. **çµæœæ­æ›‰** - å…¬å¸ƒæŠ•ç¥¨çµæœå’Œè¢«æ·˜æ±°ç©å®¶èº«ä»½
8. **å‹è² åˆ¤å®š** - æª¢æŸ¥æ˜¯å¦é”æˆå‹åˆ©æ¢ä»¶ï¼Œå¦å‰‡é€²å…¥ä¸‹ä¸€è¼ª

### è§’è‰²èªªæ˜
- **å¹³æ°‘** - ç²å¾—å¹³æ°‘è©èªï¼Œç›®æ¨™æ˜¯æ‰¾å‡ºæ‰€æœ‰è‡¥åº•
- **è‡¥åº•** - ç²å¾—è‡¥åº•è©èªï¼Œç›®æ¨™æ˜¯éš±è—èº«ä»½å­˜æ´»åˆ°æœ€å¾Œ
- **ç™½æ¿** - ä¸çŸ¥é“ä»»ä½•è©èªï¼Œéœ€è¦é€šéå…¶ä»–äººçš„æè¿°çŒœæ¸¬

### å‹åˆ©æ¢ä»¶
- **å¹³æ°‘å‹åˆ©** - æˆåŠŸæ·˜æ±°æ‰€æœ‰è‡¥åº•
- **è‡¥åº•å‹åˆ©** - è‡¥åº•äººæ•¸ â‰¥ å¹³æ°‘äººæ•¸ï¼Œæˆ–å­˜æ´»åˆ°æœ€å¾Œ

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
undercover-game/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ page.tsx           # é¦–é 
â”‚   â”œâ”€â”€ room/              # æˆ¿é–“ç›¸é—œé é¢
â”‚   â””â”€â”€ layout.tsx         # æ ¹ä½ˆå±€
â”œâ”€â”€ components/            # React çµ„ä»¶
â”‚   â”œâ”€â”€ ui/               # åŸºç¤ UI çµ„ä»¶
â”‚   â”œâ”€â”€ player-avatar.tsx # ç©å®¶é ­åƒçµ„ä»¶
â”‚   â”œâ”€â”€ chat-panel.tsx    # èŠå¤©é¢æ¿
â”‚   â”œâ”€â”€ speak-panel.tsx   # ç™¼è¨€é¢æ¿
â”‚   â”œâ”€â”€ vote-panel.tsx    # æŠ•ç¥¨é¢æ¿
â”‚   â””â”€â”€ host-panel.tsx    # æˆ¿ä¸»æ§åˆ¶é¢æ¿
â”œâ”€â”€ lib/                   # å·¥å…·å‡½æ•¸
â”‚   â”œâ”€â”€ firebase.ts       # Firebase é…ç½®
â”‚   â”œâ”€â”€ game-logic.ts     # éŠæˆ²é‚è¼¯
â”‚   â”œâ”€â”€ auth.ts           # èº«ä»½èªè­‰
â”‚   â”œâ”€â”€ avatar.ts         # é ­åƒè™•ç†
â”‚   â””â”€â”€ api-client.ts     # API å®¢æˆ¶ç«¯
â”œâ”€â”€ types/                 # TypeScript é¡å‹
â”‚   â””â”€â”€ game.ts           # éŠæˆ²ç›¸é—œé¡å‹
â”œâ”€â”€ functions/             # Firebase Functions
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ index.ts      # Cloud Functions
â”œâ”€â”€ __tests__/             # å–®å…ƒæ¸¬è©¦
â”œâ”€â”€ e2e/                   # E2E æ¸¬è©¦
â”œâ”€â”€ firestore.rules       # Firestore å®‰å…¨è¦å‰‡
â”œâ”€â”€ storage.rules         # Storage å®‰å…¨è¦å‰‡
â””â”€â”€ firebase.json         # Firebase é…ç½®
```

## ğŸ§ª æ¸¬è©¦

### å–®å…ƒæ¸¬è©¦
```bash
# é‹è¡Œæ‰€æœ‰å–®å…ƒæ¸¬è©¦
npm run test

# ç›£è½æ¨¡å¼
npm run test:watch

# ç”Ÿæˆè¦†è“‹ç‡å ±å‘Š
npm run test:coverage
```

### E2E æ¸¬è©¦
```bash
# å®‰è£ Playwright
npx playwright install

# é‹è¡Œ E2E æ¸¬è©¦
npm run test:e2e

# äº’å‹•æ¨¡å¼
npm run test:e2e:ui
```

### æ¸¬è©¦è¦†è“‹ç¯„åœ
- âœ… éŠæˆ²é‚è¼¯æ ¸å¿ƒå‡½æ•¸
- âœ… è§’è‰²åˆ†é…ç®—æ³•
- âœ… æŠ•ç¥¨è¨ˆç®—é‚è¼¯
- âœ… å‹è² åˆ¤å®šè¦å‰‡
- âœ… å…§å®¹é©—è­‰å‡½æ•¸
- âœ… å®Œæ•´éŠæˆ²æµç¨‹ E2E
- âœ… æˆ¿ä¸»æ§åˆ¶åŠŸèƒ½
- âœ… èŠå¤©ç³»çµ±
- âœ… é ­åƒåŠŸèƒ½

## ğŸ”§ API æ–‡æª”

### REST API

#### æˆ¿é–“ç®¡ç†
```typescript
POST /api/rooms
// å‰µå»ºæˆ¿é–“
Body: { hostName: string }
Response: { code: string, hostToken: string }

POST /api/rooms/:code/join
// åŠ å…¥æˆ¿é–“
Body: { name: string }
Response: { playerId: string, token: string }

GET /api/rooms/:code
// ç²å–æˆ¿é–“ä¿¡æ¯
Response: Room
```

#### éŠæˆ²æ§åˆ¶
```typescript
POST /api/rooms/:code/config
// æ›´æ–°æˆ¿é–“é…ç½®ï¼ˆæˆ¿ä¸»ï¼‰
Headers: { Authorization: "Bearer <hostToken>" }
Body: Partial<RoomConfig>

POST /api/rooms/:code/start
// é–‹å§‹éŠæˆ²ï¼ˆæˆ¿ä¸»ï¼‰
Headers: { Authorization: "Bearer <hostToken>" }

POST /api/rooms/:code/speak
// ç™¼è¨€
Headers: { Authorization: "Bearer <token>" }
Body: { text: string }

POST /api/rooms/:code/vote
// æŠ•ç¥¨
Headers: { Authorization: "Bearer <token>" }
Body: { targetId?: string }
```

#### æˆ¿ä¸»æ“ä½œ
```typescript
POST /api/rooms/:code/kick
// è¸¢å‡ºç©å®¶ï¼ˆæˆ¿ä¸»ï¼‰
Headers: { Authorization: "Bearer <hostToken>" }
Body: { targetId: string }

POST /api/rooms/:code/transfer-host
// è½‰ç§»æˆ¿ä¸»ï¼ˆæˆ¿ä¸»ï¼‰
Headers: { Authorization: "Bearer <hostToken>" }
Body: { toPlayerId: string }

POST /api/rooms/:code/tiebreak
// åŒç¥¨è£æ±ºï¼ˆæˆ¿ä¸»ï¼‰
Headers: { Authorization: "Bearer <hostToken>" }
Body: { targetId: string }
```

#### èŠå¤©ç³»çµ±
```typescript
POST /api/rooms/:code/chat
// ç™¼é€èŠå¤©è¨Šæ¯
Headers: { Authorization: "Bearer <token>" }
Body: { text: string }

GET /api/rooms/:code/messages?limit=100
// ç²å–èŠå¤©è¨˜éŒ„
Response: Message[]
```

### å¯¦æ™‚äº‹ä»¶ (SSE)

```typescript
GET /api/rooms/:code/events?token=<token>
// è¨‚é–±æˆ¿é–“äº‹ä»¶

Events:
- room.sync: æˆ¿é–“ç‹€æ…‹åŒæ­¥
- timer.tick: è¨ˆæ™‚å™¨æ›´æ–°
- speak.submitted: æœ‰äººç™¼è¨€
- vote.open: æŠ•ç¥¨é–‹å§‹
- vote.result: æŠ•ç¥¨çµæœ
- game.ended: éŠæˆ²çµæŸ
- chat.message: æ–°èŠå¤©è¨Šæ¯
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

### å…§å®¹å®‰å…¨
- ç™¼è¨€å…§å®¹é•·åº¦é™åˆ¶ï¼ˆ120 å­—ï¼‰
- èŠå¤©è¨Šæ¯é•·åº¦é™åˆ¶ï¼ˆ200 å­—ï¼‰
- ä¸é›…è©èªéæ¿¾
- é‡è¤‡å­—å…ƒæª¢æ¸¬ï¼ˆé˜²åˆ·å±ï¼‰

### é€Ÿç‡é™åˆ¶
- èŠå¤©è¨Šæ¯ï¼šæ¯ 5 ç§’ 1 å‰‡
- API è«‹æ±‚ï¼šåŸºæ–¼ IP å’Œ Token é™åˆ¶
- é ­åƒä¸Šå‚³ï¼š512KB å¤§å°é™åˆ¶

### æ¬Šé™æ§åˆ¶
- æˆ¿ä¸»å°ˆå±¬æ“ä½œé©—è­‰
- Token èº«ä»½èªè­‰
- Firestore å®‰å…¨è¦å‰‡
- Storage è¨ªå•æ§åˆ¶

## ğŸ› å·²çŸ¥å•é¡Œ

### âœ… å·²ä¿®å¾©ï¼šç„¡æ³•å‰µå»ºæˆ¿é–“
- **å•é¡Œ**ï¼šé¦–é é»æ“Šã€Œå»ºç«‹æˆ¿é–“ã€ç„¡æ³•å‰µå»ºæˆ¿é–“
- **åŸå› **ï¼šAPI å®¢æˆ¶ç«¯æŒ‡å‘ Firebase Functionsï¼Œä½† Functions éœ€è¦ä»˜è²»æ–¹æ¡ˆ
- **ä¿®å¾©**ï¼š
  - æ·»åŠ  Next.js API Routes ä½œç‚ºæœ¬åœ°é–‹ç™¼å¾Œç«¯
  - ä¿®å¾©é¦–é çµ„ä»¶ä½¿ç”¨æ­£ç¢ºçš„ API å®¢æˆ¶ç«¯
  - æ·»åŠ éŒ¯èª¤è™•ç†å’Œé‡è©¦ UI
  - æ·»åŠ  E2E æ¸¬è©¦é©—è­‰å‰µå»ºæˆ¿é–“æµç¨‹

### ğŸ”§ æœ¬åœ°é–‹ç™¼è¨­ç½®

ç”±æ–¼ Firebase Functions éœ€è¦ä»˜è²»æ–¹æ¡ˆï¼Œæœ¬åœ°é–‹ç™¼ä½¿ç”¨ Next.js API Routesï¼š

```bash
# å•Ÿå‹•æœ¬åœ°é–‹ç™¼æœå‹™å™¨
npm run dev

# è¨ªå• http://localhost:3000
# å‰µå»ºæˆ¿é–“åŠŸèƒ½ç¾åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œ
```

### ğŸš€ ç”Ÿç”¢éƒ¨ç½²

è¦åœ¨ç”Ÿç”¢ç’°å¢ƒå•Ÿç”¨å®Œæ•´åŠŸèƒ½ï¼š

1. å‡ç´š Firebase åˆ° Blaze æ–¹æ¡ˆ
2. éƒ¨ç½² Cloud Functionsï¼š`firebase deploy --only functions`
3. æ›´æ–° API_BASE é…ç½®æŒ‡å‘ Functions

## ğŸ“„ æˆæ¬Š

MIT License - è©³è¦‹ [LICENSE](LICENSE) æ–‡ä»¶

---

**ğŸ® é–‹å§‹ä½ çš„è‡¥åº•ä¹‹æ—…å§ï¼**
